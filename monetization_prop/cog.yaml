# Configuration for Cog ⚙️
# Reference: https://github.com/replicate/cog/blob/main/docs/yaml.md

build:
  gpu: True
  cuda: "11.8"
  python_version: "3.11"
  system_packages:
    - "libgl1-mesa-glx"
    - "ffmpeg"
    - "libsm6"
    - "libxext6"
    - "wget"
  
  python_packages:
    - "uv"  # Install uv first
  # Install uv and use it for faster package installation
  run:
    - "uv pip install --system diffusers==0.28.2 torch==2.0.1 transformers==4.36.0 huggingface-hub==0.20.2 invisible-watermark==0.2.0 accelerate==0.23.0 pandas==2.0.3 torchvision==0.15.1 numpy==1.24.3 fire==0.5.0 Pillow mediapipe==0.10.3 && rm -rf /root/.cache /tmp/* /var/tmp/* && apt-get clean && rm -rf /var/lib/apt/lists/* && find /usr/local -type d -name 'tests' -prune -exec rm -rf {} + || true && find /usr/local -type d -name 'test' -prune -exec rm -rf {} + || true && rm -rf /usr/share/doc/* /usr/share/man/*"

    # - "uv pip install --system  \
    #   diffusers==0.28.2 \
    #   torch==2.0.1  \
    #   transformers==4.36.0  \
    #   huggingface-hub==0.20.2 \
    #   invisible-watermark==0.2.0  \
    #   accelerate==0.21.0  \
    #   pandas==2.0.3 \
    #   torchvision==0.15.2 \
    #   numpy==1.26.4 \
    #   pandas==2.0.3 \
    #   fire==0.5.0 \
    #   mediapipe==0.10.21  \
    #   pillow   &&\
      
    # rm -rf /root/.cache /tmp/* /var/tmp/*. && \
    # rm -rf /var/lib/apt/lists/*  && \
    # apt-get clean && \
    # find /usr/local -type d -name 'tests' -prune -exec rm -rf {} + || true  && \
    # find /usr/local -type d -name 'test' -prune -exec rm -rf {} + || true  && \
    # rm -rf /usr/share/doc/* /usr/share/man/*"
        
predict: "predict.py:Predictor"