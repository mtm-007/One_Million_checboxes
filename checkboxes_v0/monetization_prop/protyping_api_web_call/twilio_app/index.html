<!DOCTYPE html>
<html>
<head>
  <title>Twilio Voice Test</title>
</head>
<body>
  <h2>Twilio Voice Test</h2>
  <div id="status">Status: Fetching token...</div>

  <input type="text" id="phoneNumber" placeholder="Enter phone number e.g. +14155552671">
  <button id="callButton" disabled>Call</button>
  <button id="hangupButton" disabled>Hang Up</button>

  <!-- Latest Twilio JS SDK -->
  <script src="https://media.twiliocdn.com/sdk/js/voice/latest/twilio-voice.min.js"></script>

  <script>
    let device;
    let connection;

    async function initDevice() {
  console.log("Fetching token...");
  const response = await fetch("https://journalary-pamela-soundlessly.ngrok-free.dev/token?identity=webUser");
  const data = await response.json();
  console.log("Token fetched:", data);

  device = new Twilio.Device(data.token, { debug: true });

  device.on("ready", () => console.log("âœ… Device Ready"));
  device.on("error", err => console.error("âŒ Device Error:", err));
  device.on("connect", () => console.log("ðŸ“ž Call connected"));
  device.on("disconnect", () => console.log("â˜Žï¸ Call ended"));
  device.on("incoming", () => console.log("ðŸ“² Incoming call"));
}
initDevice();
  </script>
</body>
</html>
